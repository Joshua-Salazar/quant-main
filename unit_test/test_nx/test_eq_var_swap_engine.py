
"""
Created on 14th March 2024

@author: ewang
"""

import unittest
from ctp.specifications.currency import Currency
from ctp.specifications.daycount import DayCountConvention
from ctp.instruments.indices import Fixing, Fixings
from ctp.instruments.specs import BuySell
from ctp.instruments.swaps import VarSwap
from ctp.models.vol import NxEQVolatilityEngine, EqVolatilityGrid, Slice, VolSliceMap
from ctp.pricing.engines import NxEqVarSwapEngine
from ctp.specifications.daycount import Actual365
from ctp.specifications.defs import Notional, Strike, AnnualRate
from ctp.termstructures.common import InterestRateTermStructure
from ctp.utils.time import Calendar, Date, DayDuration, TimePoint

__author__ = "ewang"


class Test(unittest.TestCase):
    def setUp(self):
        self.refDate = Date(2024, 1, 18)
        self.valuationTimePoint = TimePoint(self.refDate)

        self.underlying = "SPX"
        self.underlyingID = "65"
        self.underlyingPricingID = "65"
        self.exchCode = "US"
        self.instrumentID = "65712380"
        self.buySell = BuySell.BUY
        self.notional = Notional(1000000)
        self.strike = Strike(22.05)
        self.ccy = Currency.USD
        self.effTimePoint = TimePoint(Date(2023, 5, 24))
        self.matTimePoint = TimePoint(Date(2024, 12, 20))
        self.lag = 1
        self.cap = 0.

        self.dcc = DayCountConvention.A365
        self.dc = Actual365()
        self.strikes = [
            0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.875, 0.9, 0.925, 0.95, 0.975, 1, 1.025, 1.05,
            1.075, 1.1, 1.15, 1.2, 1.25, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.25, 2.5, 3
        ]

        self.expiryDate = [
            Date(2024, 1, 23),
            Date(2024, 1, 28),
            Date(2024, 2, 7),
            Date(2024, 2, 18),
            Date(2024, 3, 18),
            Date(2024, 4, 18),
            Date(2024, 7, 18),
            Date(2024, 10, 18),
            Date(2025, 1, 18),
            Date(2025, 7, 18),
            Date(2026, 1, 18),
            Date(2027, 1, 18),
            Date(2028, 1, 18),
            Date(2029, 1, 18),
            Date(2030, 1, 18),
        ]

        self.volbyStrikeExpiry = [
            [2.53184, 2.10348, 1.80642, 1.56175, 1.34159, 1.13031, 1.02387, 0.914341, 0.79899, 0.673431, 0.530706, 0.453275, 0.37365, 0.292913, 0.211392, 0.139327, 0.105388, 0.106844, 0.167209, 0.217428, 0.25719, 0.32037, 0.370909, 0.413623, 0.450865, 0.51392, 0.566347, 0.611333, 0.650764, 0.685868, 0.717494, 0.74626, 0.80845, 0.860279, 0.943263],
            [2.06649, 1.71348, 1.46815, 1.26556, 1.08263, 0.906147, 0.81671, 0.724122, 0.625733, 0.518819, 0.404986, 0.3462, 0.287044, 0.22888, 0.173708, 0.131029, 0.105282, 0.0972442, 0.124412, 0.166333, 0.200281, 0.253332, 0.295326, 0.330631, 0.361316, 0.413121, 0.456091, 0.492907, 0.525145, 0.553824, 0.579647, 0.603125, 0.653852, 0.696104, 0.763717],
            [1.65195, 1.36391, 1.16281, 0.995784, 0.843762, 0.695301, 0.619184, 0.541749, 0.464108, 0.386957, 0.309105, 0.269551, 0.231006, 0.195404, 0.164516, 0.138319, 0.117615, 0.105832, 0.10562, 0.120274, 0.142924, 0.185906, 0.219517, 0.247503, 0.27169, 0.312319, 0.34588, 0.374562, 0.399634, 0.42191, 0.44195, 0.460155, 0.499454, 0.532154, 0.584434],
            [1.4702, 1.21104, 1.02963, 0.878491, 0.740301, 0.604781, 0.537142, 0.470398, 0.404925, 0.340013, 0.274439, 0.242534, 0.212587, 0.18512, 0.160336, 0.137748, 0.118454, 0.105879, 0.101348, 0.107145, 0.120492, 0.158103, 0.190098, 0.216387, 0.238935, 0.276567, 0.307489, 0.333831, 0.356809, 0.377194, 0.39551, 0.412135, 0.447981, 0.477773, 0.52535],
            [1.21961, 0.999532, 0.844615, 0.714615, 0.595482, 0.485115, 0.433449, 0.383726, 0.335066, 0.28708, 0.241003, 0.219159, 0.198325, 0.178535, 0.159274, 0.140516, 0.123539, 0.110542, 0.103302, 0.100723, 0.104655, 0.125154, 0.148201, 0.168505, 0.185959, 0.215106, 0.239068, 0.259488, 0.277304, 0.29311, 0.307315, 0.320208, 0.348013, 0.371124, 0.408035],
            [1.10472, 0.900721, 0.756295, 0.634697, 0.527617, 0.432961, 0.389122, 0.346635, 0.305246, 0.265506, 0.227936, 0.210008, 0.192645, 0.17575, 0.159239, 0.143316, 0.128539, 0.115962, 0.107207, 0.102296, 0.100736, 0.110641, 0.128552, 0.145246, 0.159972, 0.184675, 0.205014, 0.222362, 0.237507, 0.25095, 0.263035, 0.274007, 0.297676, 0.317357, 0.348799],
            [0.92936, 0.750938, 0.625456, 0.525471, 0.44097, 0.36681, 0.332736, 0.300529, 0.270144, 0.241545, 0.214709, 0.201864, 0.189307, 0.176975, 0.164831, 0.152891, 0.141348, 0.130553, 0.121071, 0.113695, 0.108475, 0.103687, 0.106917, 0.115579, 0.126268, 0.146694, 0.164263, 0.179213, 0.1922, 0.203687, 0.213986, 0.223318, 0.243397, 0.260048, 0.286585],
            [0.822171, 0.663063, 0.554147, 0.467649, 0.395184, 0.332864, 0.304758, 0.278477, 0.254053, 0.231539, 0.210562, 0.200417, 0.190393, 0.180461, 0.170596, 0.160768, 0.150965, 0.141355, 0.132251, 0.124152, 0.117611, 0.108985, 0.105649, 0.107359, 0.11231, 0.126116, 0.140792, 0.154478, 0.166703, 0.177487, 0.187116, 0.195815, 0.214457, 0.229855, 0.254308],
            [0.763501, 0.614359, 0.51259, 0.433118, 0.368246, 0.313877, 0.289906, 0.267912, 0.247833, 0.229378, 0.211972, 0.203494, 0.19509, 0.186709, 0.178298, 0.169802, 0.161189, 0.152596, 0.144239, 0.136388, 0.129377, 0.118756, 0.112336, 0.109756, 0.110703, 0.118678, 0.129808, 0.14179, 0.15352, 0.164484, 0.174452, 0.183426, 0.202533, 0.218212, 0.242964],
            [0.682868, 0.548062, 0.456799, 0.388616, 0.33522, 0.29228, 0.2738, 0.256942, 0.241382, 0.226733, 0.212664, 0.205765, 0.198917, 0.19209, 0.185256, 0.178386, 0.17147, 0.164543, 0.157653, 0.150865, 0.144343, 0.132913, 0.124347, 0.118506, 0.115168, 0.115147, 0.120936, 0.129251, 0.138443, 0.147536, 0.156136, 0.164124, 0.181495, 0.195779, 0.218295],
            [0.628912, 0.500271, 0.41928, 0.361325, 0.316731, 0.280812, 0.26525, 0.250942, 0.237629, 0.225077, 0.213072, 0.207208, 0.201405, 0.195629, 0.189836, 0.183982, 0.178042, 0.17206, 0.166095, 0.160205, 0.15446, 0.143761, 0.1347, 0.127601, 0.122481, 0.117532, 0.118047, 0.122407, 0.129158, 0.136859, 0.144559, 0.15173, 0.16712, 0.179818, 0.199982],
            [0.539949, 0.427785, 0.368896, 0.328476, 0.296326, 0.268741, 0.2563, 0.244771, 0.234153, 0.224338, 0.215106, 0.210643, 0.206243, 0.201869, 0.197487, 0.193063, 0.18858, 0.18405, 0.179493, 0.174926, 0.170368, 0.161398, 0.152936, 0.145354, 0.1389, 0.129694, 0.124927, 0.123573, 0.124812, 0.127736, 0.13164, 0.136092, 0.148101, 0.15968, 0.179383],
            [0.487311, 0.392192, 0.344598, 0.312963, 0.287077, 0.264058, 0.253699, 0.244142, 0.235347, 0.227231, 0.219721, 0.216165, 0.21269, 0.209249, 0.205794, 0.202285, 0.198691, 0.195023, 0.191305, 0.187561, 0.183814, 0.176386, 0.169177, 0.162336, 0.156003, 0.145324, 0.137851, 0.133482, 0.131469, 0.131035, 0.131691, 0.1333, 0.140663, 0.150458, 0.169345],
            [0.458179, 0.375134, 0.335072, 0.307619, 0.283527, 0.262512, 0.253559, 0.245681, 0.238656, 0.232242, 0.226249, 0.223349, 0.220473, 0.217591, 0.214679, 0.211713, 0.208675, 0.205568, 0.202415, 0.199234, 0.196044, 0.189701, 0.183501, 0.177519, 0.171806, 0.161376, 0.152666, 0.14625, 0.142022, 0.139274, 0.137606, 0.136932, 0.138809, 0.143895, 0.157561],
            [0.440584, 0.367786, 0.330615, 0.304215, 0.28253, 0.264672, 0.257031, 0.250133, 0.243863, 0.238128, 0.232848, 0.230329, 0.227844, 0.225362, 0.222856, 0.220301, 0.217676, 0.214969, 0.212199, 0.209383, 0.20654, 0.200836, 0.195198, 0.189713, 0.184421, 0.174507, 0.165619, 0.158012, 0.152009, 0.147651, 0.144601, 0.142542, 0.140738, 0.142416, 0.150971],
        ]

        self.spot = 4779.825

        self.borrowCurveData = [
            (DayDuration(0), AnnualRate(0)),
            (DayDuration(1), AnnualRate(-0.00640865361088)),
            (DayDuration(4), AnnualRate(0.0193809208746)),
            (DayDuration(5), AnnualRate(0.0251394904655)),
            (DayDuration(6), AnnualRate(0.0233679427386)),
            (DayDuration(7), AnnualRate(0.00354751933346)),
            (DayDuration(8), AnnualRate(0.00287609187006)),
            (DayDuration(11), AnnualRate(0.010250934722)),
            (DayDuration(12), AnnualRate(0.00985258490911)),
            (DayDuration(13), AnnualRate(0.00918434729326)),
            (DayDuration(14), AnnualRate(-0.000198306557354)),
            (DayDuration(15), AnnualRate(-0.000358915009547)),
            (DayDuration(18), AnnualRate(0.00529444533361)),
            (DayDuration(19), AnnualRate(0.00506896433565)),
            (DayDuration(20), AnnualRate(0.00483976664614)),
            (DayDuration(21), AnnualRate(-0.00138687886939)),
            (DayDuration(22), AnnualRate(-0.000433451188289)),
            (DayDuration(25), AnnualRate(0.00430150917608)),
            (DayDuration(26), AnnualRate(0.00322920360291)),
            (DayDuration(27), AnnualRate(0.00286985566649)),
            (DayDuration(28), AnnualRate(-0.0035108197316)),
            (DayDuration(29), AnnualRate(-0.00551174279207)),
            (DayDuration(33), AnnualRate(0.00134123855564)),
            (DayDuration(34), AnnualRate(0.00124692912332)),
            (DayDuration(35), AnnualRate(-0.00202988769985)),
            (DayDuration(36), AnnualRate(-0.00216217601455)),
            (DayDuration(39), AnnualRate(0.000777348273368)),
            (DayDuration(42), AnnualRate(-0.00165439679594)),
            (DayDuration(43), AnnualRate(-0.00148878597439)),
            (DayDuration(46), AnnualRate(0.000401892459317)),
            (DayDuration(57), AnnualRate(-0.00289741183369)),
            (DayDuration(70), AnnualRate(-0.00244248161852)),
            (DayDuration(92), AnnualRate(-0.00140926823234)),
            (DayDuration(103), AnnualRate(-0.000466903393195)),
            (DayDuration(120), AnnualRate(-0.00202461690502)),
            (DayDuration(134), AnnualRate(-0.00233869168911)),
            (DayDuration(155), AnnualRate(-0.00216227868025)),
            (DayDuration(162), AnnualRate(-0.00193573553095)),
            (DayDuration(183), AnnualRate(-0.00227295765721)),
            (DayDuration(211), AnnualRate(-0.00271573250577)),
            (DayDuration(246), AnnualRate(-0.00273351890511)),
            (DayDuration(256), AnnualRate(-0.00219571528489)),
            (DayDuration(274), AnnualRate(-0.00287512495903)),
            (DayDuration(302), AnnualRate(-0.00253005450679)),
            (DayDuration(337), AnnualRate(-0.00194073467258)),
            (DayDuration(348), AnnualRate(-0.00173077477339)),
            (DayDuration(365), AnnualRate(-0.00202925146083)),
            (DayDuration(400), AnnualRate(-0.00207789973454)),
            (DayDuration(428), AnnualRate(-0.00199713726967)),
            (DayDuration(519), AnnualRate(-0.00193948764079)),
            (DayDuration(701), AnnualRate(-0.00178795599462)),
            (DayDuration(1065), AnnualRate(-0.00241586114693)),
            (DayDuration(1429), AnnualRate(0.00123032881198)),
            (DayDuration(1793), AnnualRate(0.00367973044089)),
            (DayDuration(2164), AnnualRate(0.00546199281431)),
        ]

        self.yieldCurveData = [
            (DayDuration(0), AnnualRate(0)),
            (DayDuration(1), AnnualRate(0.00696612955715)),
            (DayDuration(4), AnnualRate(0.03039765625)),
            (DayDuration(5), AnnualRate(0.045596484375)),
            (DayDuration(6), AnnualRate(0.0506945586543)),
            (DayDuration(7), AnnualRate(0.0543496680985)),
            (DayDuration(8), AnnualRate(0.0571029245208)),
            (DayDuration(11), AnnualRate(0.0485420248497)),
            (DayDuration(12), AnnualRate(0.0508853480802)),
            (DayDuration(13), AnnualRate(0.0528754980993)),
            (DayDuration(14), AnnualRate(0.0545881548809)),
            (DayDuration(15), AnnualRate(0.0560788170724)),
            (DayDuration(18), AnnualRate(0.0510761375061)),
            (DayDuration(19), AnnualRate(0.0524528814212)),
            (DayDuration(20), AnnualRate(0.0536967206804)),
            (DayDuration(21), AnnualRate(0.0548266416632)),
            (DayDuration(22), AnnualRate(0.05585817868)),
            (DayDuration(25), AnnualRate(0.052324699673)),
            (DayDuration(26), AnnualRate(0.0533047743075)),
            (DayDuration(27), AnnualRate(0.0542157839585)),
            (DayDuration(28), AnnualRate(0.0550651284455)),
            (DayDuration(29), AnnualRate(0.0544183745625)),
            (DayDuration(33), AnnualRate(0.0515531110707)),
            (DayDuration(34), AnnualRate(0.0523435109159)),
            (DayDuration(35), AnnualRate(0.0530914706188)),
            (DayDuration(36), AnnualRate(0.053800526858)),
            (DayDuration(39), AnnualRate(0.0517439004966)),
            (DayDuration(42), AnnualRate(0.0536906986099)),
            (DayDuration(43), AnnualRate(0.0542837024447)),
            (DayDuration(46), AnnualRate(0.0525313412923)),
            (DayDuration(57), AnnualRate(0.0542092916575)),
            (DayDuration(70), AnnualRate(0.0552719680749)),
            (DayDuration(92), AnnualRate(0.0551491844338)),
            (DayDuration(103), AnnualRate(0.0548386006121)),
            (DayDuration(120), AnnualRate(0.0548978170877)),
            (DayDuration(134), AnnualRate(0.0544260322126)),
            (DayDuration(155), AnnualRate(0.0533292646434)),
            (DayDuration(162), AnnualRate(0.0535025292724)),
            (DayDuration(183), AnnualRate(0.0525224502457)),
            (DayDuration(211), AnnualRate(0.0521325315176)),
            (DayDuration(246), AnnualRate(0.0512395192346)),
            (DayDuration(256), AnnualRate(0.0508950429868)),
            (DayDuration(274), AnnualRate(0.0507465955303)),
            (DayDuration(302), AnnualRate(0.0506500908275)),
            (DayDuration(337), AnnualRate(0.0502480784385)),
            (DayDuration(348), AnnualRate(0.0499161202643)),
            (DayDuration(365), AnnualRate(0.049698009937)),
            (DayDuration(400), AnnualRate(0.0488297536382)),
            (DayDuration(428), AnnualRate(0.0483775322629)),
            (DayDuration(519), AnnualRate(0.0468798841437)),
            (DayDuration(701), AnnualRate(0.0449477163523)),
            (DayDuration(1065), AnnualRate(0.0429399634386)),
            (DayDuration(1429), AnnualRate(0.0425172654006)),
            (DayDuration(1793), AnnualRate(0.04276873995)),
            (DayDuration(2164), AnnualRate(0.0433958364772)),
        ]

        self.dividendCurveData = [
            (Date(2024, 1, 19), 0.275),
            (Date(2024, 1, 23), 0.108),
            (Date(2024, 1, 24), 0.042),
            (Date(2024, 1, 25), 0.371),
            (Date(2024, 1, 27), 0.089),
            (Date(2024, 1, 30), 0.378),
            (Date(2024, 1, 31), 0.131),
            (Date(2024, 2, 1), 0.266),
            (Date(2024, 2, 2), 0.197),
            (Date(2024, 2, 3), 0.084),
            (Date(2024, 2, 6), 0.101),
            (Date(2024, 2, 7), 0.074),
            (Date(2024, 2, 8), 0.648),
            (Date(2024, 2, 9), 0.482),
            (Date(2024, 2, 10), 0.056),
            (Date(2024, 2, 13), 0.775),
            (Date(2024, 2, 14), 1.002),
            (Date(2024, 2, 15), 0.888),
            (Date(2024, 2, 16), 0.863),
            (Date(2024, 2, 17), 0.153),
            (Date(2024, 2, 21), 0.106),
            (Date(2024, 2, 22), 0.299),
            (Date(2024, 2, 23), 0.085),
            (Date(2024, 2, 24), 0.132),
            (Date(2024, 2, 27), 0.064),
            (Date(2024, 2, 28), 0.703),
            (Date(2024, 2, 29), 0.576),
            (Date(2024, 3, 1), 0.205),
            (Date(2024, 3, 2), 0.321),
            (Date(2024, 3, 5), 0.121),
            (Date(2024, 3, 6), 0.451),
            (Date(2024, 3, 7), 0.791),
            (Date(2024, 3, 8), 0.423),
            (Date(2024, 3, 9), 0.088),
            (Date(2024, 3, 12), 0.236),
            (Date(2024, 3, 13), 0.053),
            (Date(2024, 3, 14), 1.399),
            (Date(2024, 3, 15), 0.089),
            (Date(2024, 3, 16), 0.017),
            (Date(2024, 3, 19), 0.305),
            (Date(2024, 3, 20), 0.256),
            (Date(2024, 3, 21), 0.09),
            (Date(2024, 3, 22), 0.26),
            (Date(2024, 3, 23), 0.109),
            (Date(2024, 3, 27), 0.647),
            (Date(2024, 3, 28), 0.157),
            (Date(2024, 3, 29), 0.362),
            (Date(2024, 4, 3), 0.245),
            (Date(2024, 4, 4), 0.429),
            (Date(2024, 4, 5), 0.024),
            (Date(2024, 4, 6), 0.016),
            (Date(2024, 4, 9), 0.732),
            (Date(2024, 4, 10), 0.076),
            (Date(2024, 4, 11), 0.124),
            (Date(2024, 4, 12), 0.559),
            (Date(2024, 4, 16), 0.074),
            (Date(2024, 4, 17), 0.145),
            (Date(2024, 4, 18), 0.305),
            (Date(2024, 4, 19), 0.115),
            (Date(2024, 4, 23), 0.163),
            (Date(2024, 4, 25), 0.075),
            (Date(2024, 4, 26), 0.348),
            (Date(2024, 4, 27), 0.235),
            (Date(2024, 4, 30), 0.171),
            (Date(2024, 5, 1), 0.012),
            (Date(2024, 5, 2), 0.319),
            (Date(2024, 5, 3), 0.099),
            (Date(2024, 5, 4), 0.297),
            (Date(2024, 5, 7), 0.043),
            (Date(2024, 5, 8), 0.176),
            (Date(2024, 5, 9), 1.074),
            (Date(2024, 5, 10), 0.656),
            (Date(2024, 5, 11), 0.091),
            (Date(2024, 5, 14), 0.926),
            (Date(2024, 5, 15), 0.727),
            (Date(2024, 5, 16), 1.048),
            (Date(2024, 5, 17), 0.231),
            (Date(2024, 5, 18), 0.47),
            (Date(2024, 5, 21), 0.231),
            (Date(2024, 5, 22), 0.05),
            (Date(2024, 5, 23), 0.21),
            (Date(2024, 5, 24), 0.21),
            (Date(2024, 5, 25), 0.113),
            (Date(2024, 5, 29), 0.452),
            (Date(2024, 5, 30), 0.329),
            (Date(2024, 5, 31), 0.747),
            (Date(2024, 6, 1), 0.235),
            (Date(2024, 6, 4), 0.139),
            (Date(2024, 6, 5), 0.14),
            (Date(2024, 6, 6), 0.765),
            (Date(2024, 6, 7), 0.257),
            (Date(2024, 6, 8), 0.015),
            (Date(2024, 6, 11), 0.17),
            (Date(2024, 6, 12), 0.097),
            (Date(2024, 6, 13), 1.296),
            (Date(2024, 6, 14), 0.575),
            (Date(2024, 6, 15), 0.02),
            (Date(2024, 6, 18), 0.087),
            (Date(2024, 6, 19), 0.351),
            (Date(2024, 6, 21), 0.299),
            (Date(2024, 6, 22), 0.117),
            (Date(2024, 6, 25), 0.009),
            (Date(2024, 6, 26), 0.019),
            (Date(2024, 6, 27), 0.588),
            (Date(2024, 6, 28), 0.159),
            (Date(2024, 6, 29), 0.507),
            (Date(2024, 7, 2), 0.022),
            (Date(2024, 7, 3), 0.372),
            (Date(2024, 7, 4), 0.065),
            (Date(2024, 7, 6), 0.219),
            (Date(2024, 7, 9), 0.751),
            (Date(2024, 7, 10), 0.076),
            (Date(2024, 7, 11), 0.05),
            (Date(2024, 7, 12), 0.567),
            (Date(2024, 7, 16), 0.076),
            (Date(2024, 7, 17), 0.145),
            (Date(2024, 7, 18), 0.306),
            (Date(2024, 7, 19), 0.094),
            (Date(2024, 7, 20), 0.177),
            (Date(2024, 7, 23), 0.085),
            (Date(2024, 7, 24), 0.043),
            (Date(2024, 7, 25), 0.349),
            (Date(2024, 7, 26), 0.262),
            (Date(2024, 7, 27), 0.153),
            (Date(2024, 7, 30), 0.237),
            (Date(2024, 7, 31), 0.221),
            (Date(2024, 8, 1), 0.248),
            (Date(2024, 8, 2), 0.027),
            (Date(2024, 8, 3), 0.09),
            (Date(2024, 8, 6), 0.111),
            (Date(2024, 8, 7), 0.169),
            (Date(2024, 8, 8), 0.786),
            (Date(2024, 8, 9), 0.667),
            (Date(2024, 8, 10), 0.019),
            (Date(2024, 8, 13), 0.741),
            (Date(2024, 8, 14), 1.134),
            (Date(2024, 8, 15), 0.451),
            (Date(2024, 8, 16), 0.825),
            (Date(2024, 8, 17), 0.079),
            (Date(2024, 8, 20), 0.211),
            (Date(2024, 8, 21), 0.101),
            (Date(2024, 8, 22), 0.147),
            (Date(2024, 8, 23), 0.446),
            (Date(2024, 8, 24), 0.099),
            (Date(2024, 8, 27), 0.079),
            (Date(2024, 8, 28), 0.393),
            (Date(2024, 8, 29), 0.486),
            (Date(2024, 8, 30), 0.714),
            (Date(2024, 8, 31), 0.132),
            (Date(2024, 9, 4), 0.224),
            (Date(2024, 9, 5), 0.924),
            (Date(2024, 9, 6), 0.078),
            (Date(2024, 9, 7), 0.226),
            (Date(2024, 9, 10), 0.156),
            (Date(2024, 9, 11), 0.023),
            (Date(2024, 9, 12), 1.11),
            (Date(2024, 9, 13), 0.629),
            (Date(2024, 9, 14), 0.027),
            (Date(2024, 9, 17), 0.147),
            (Date(2024, 9, 18), 0.065),
            (Date(2024, 9, 19), 0.114),
            (Date(2024, 9, 20), 0.303),
            (Date(2024, 9, 21), 0.181),
            (Date(2024, 9, 24), 0.316),
            (Date(2024, 9, 26), 0.041),
            (Date(2024, 9, 27), 0.607),
            (Date(2024, 9, 28), 0.151),
            (Date(2024, 10, 1), 0.007),
            (Date(2024, 10, 2), 0.008),
            (Date(2024, 10, 3), 0.809),
            (Date(2024, 10, 4), 0.01),
            (Date(2024, 10, 5), 0.299),
            (Date(2024, 10, 8), 0.087),
            (Date(2024, 10, 9), 0.823),
            (Date(2024, 10, 10), 0.049),
            (Date(2024, 10, 11), 0.549),
            (Date(2024, 10, 15), 0.01),
            (Date(2024, 10, 16), 0.186),
            (Date(2024, 10, 17), 0.283),
            (Date(2024, 10, 18), 0.134),
            (Date(2024, 10, 19), 0.115),
            (Date(2024, 10, 22), 0.083),
            (Date(2024, 10, 24), 0.063),
            (Date(2024, 10, 25), 0.138),
            (Date(2024, 10, 26), 0.066),
            (Date(2024, 10, 29), 0.009),
            (Date(2024, 10, 30), 0.364),
            (Date(2024, 10, 31), 0.327),
            (Date(2024, 11, 1), 0.116),
            (Date(2024, 11, 2), 0.096),
            (Date(2024, 11, 5), 0.146),
            (Date(2024, 11, 6), 0.2),
            (Date(2024, 11, 7), 1.314),
            (Date(2024, 11, 8), 0.72),
            (Date(2024, 11, 12), 0.313),
            (Date(2024, 11, 13), 0.046),
            (Date(2024, 11, 14), 1.359),
            (Date(2024, 11, 15), 0.552),
            (Date(2024, 11, 16), 0.783),
            (Date(2024, 11, 19), 0.159),
            (Date(2024, 11, 20), 0.875),
            (Date(2024, 11, 21), 0.212),
            (Date(2024, 11, 22), 0.054),
            (Date(2024, 11, 23), 0.074),
            (Date(2024, 11, 26), 0.184),
            (Date(2024, 11, 27), 0.652),
            (Date(2024, 11, 28), 0.85),
            (Date(2024, 11, 30), 0.089),
            (Date(2024, 12, 3), 0.065),
            (Date(2024, 12, 4), 0.254),
            (Date(2024, 12, 5), 1.051),
            (Date(2024, 12, 6), 0.306),
            (Date(2024, 12, 7), 0.147),
            (Date(2024, 12, 10), 0.144),
            (Date(2024, 12, 11), 0.058),
            (Date(2024, 12, 12), 0.864),
            (Date(2024, 12, 13), 0.355),
            (Date(2024, 12, 14), 0.056),
            (Date(2024, 12, 17), 0.074),
            (Date(2024, 12, 18), 0.16),
            (Date(2024, 12, 19), 0.436),
            (Date(2024, 12, 20), 0.314),
            (Date(2024, 12, 21), 0.25),
            (Date(2024, 12, 24), 0.298),
            (Date(2024, 12, 25), 0.193),
            (Date(2024, 12, 27), 0.283),
            (Date(2024, 12, 28), 0.489),
            (Date(2024, 12, 31), 0.188),
            (Date(2025, 1, 1), 0.403),
            (Date(2025, 1, 3), 0.452),
            (Date(2025, 1, 4), 0.193),
            (Date(2025, 1, 7), 0.112),
            (Date(2025, 1, 8), 0.082),
            (Date(2025, 1, 9), 0.696),
            (Date(2025, 1, 10), 0.01),
            (Date(2025, 1, 11), 0.541),
            (Date(2025, 1, 14), 0.116),
            (Date(2025, 1, 15), 0.112),
            (Date(2025, 1, 16), 0.15),
            (Date(2025, 1, 17), 0.247),
            (Date(2025, 1, 18), 0.164),
            (Date(2025, 1, 23), 0.313),
            (Date(2025, 1, 24), 0.337),
            (Date(2025, 1, 28), 0.112),
            (Date(2025, 1, 30), 0.464),
            (Date(2025, 1, 31), 0.286),
            (Date(2025, 2, 1), 0.04),
            (Date(2025, 2, 4), 0.1),
            (Date(2025, 2, 5), 0.022),
            (Date(2025, 2, 6), 0.558),
            (Date(2025, 2, 7), 0.867),
            (Date(2025, 2, 8), 0.107),
            (Date(2025, 2, 11), 0.057),
            (Date(2025, 2, 12), 0.053),
            (Date(2025, 2, 13), 1.139),
            (Date(2025, 2, 14), 0.9),
            (Date(2025, 2, 15), 0.528),
            (Date(2025, 2, 19), 0.895),
            (Date(2025, 2, 20), 0.561),
            (Date(2025, 2, 21), 0.417),
            (Date(2025, 2, 22), 0.163),
            (Date(2025, 2, 25), 0.059),
            (Date(2025, 2, 26), 0.141),
            (Date(2025, 2, 27), 0.4),
            (Date(2025, 2, 28), 0.782),
            (Date(2025, 3, 1), 0.212),
            (Date(2025, 3, 4), 0.106),
            (Date(2025, 3, 5), 0.735),
            (Date(2025, 3, 6), 0.553),
            (Date(2025, 3, 7), 0.368),
            (Date(2025, 3, 8), 0.235),
            (Date(2025, 3, 11), 0.086),
            (Date(2025, 3, 12), 0.197),
            (Date(2025, 3, 13), 1.048),
            (Date(2025, 3, 14), 0.68),
            (Date(2025, 3, 15), 0.046),
            (Date(2025, 3, 18), 0.091),
            (Date(2025, 3, 20), 0.381),
            (Date(2025, 3, 21), 0.351),
            (Date(2025, 3, 22), 0.215),
            (Date(2025, 3, 26), 0.072),
            (Date(2025, 3, 27), 0.199),
            (Date(2025, 3, 28), 0.583),
            (Date(2025, 3, 29), 0.307),
            (Date(2025, 4, 1), 0.39),
            (Date(2025, 4, 2), 0.034),
            (Date(2025, 4, 3), 0.247),
            (Date(2025, 4, 4), 0.087),
            (Date(2025, 4, 5), 0.259),
            (Date(2025, 4, 9), 0.691),
            (Date(2025, 4, 10), 0.053),
            (Date(2025, 4, 11), 0.212),
            (Date(2025, 4, 12), 0.516),
            (Date(2025, 4, 16), 0.255),
            (Date(2025, 4, 17), 0.027),
            (Date(2025, 4, 18), 0.173),
            (Date(2025, 4, 22), 0.085),
            (Date(2025, 4, 23), 0.329),
            (Date(2025, 4, 24), 0.065),
            (Date(2025, 4, 25), 0.298),
            (Date(2025, 4, 26), 0.147),
            (Date(2025, 4, 29), 0.243),
            (Date(2025, 4, 30), 0.097),
            (Date(2025, 5, 1), 0.426),
            (Date(2025, 5, 2), 0.007),
            (Date(2025, 5, 3), 0.171),
            (Date(2025, 5, 6), 0.135),
            (Date(2025, 5, 7), 0.107),
            (Date(2025, 5, 8), 0.62),
            (Date(2025, 5, 9), 1.172),
            (Date(2025, 5, 10), 0.163),
            (Date(2025, 5, 13), 0.002),
            (Date(2025, 5, 14), 1.727),
            (Date(2025, 5, 15), 0.628),
            (Date(2025, 5, 16), 0.762),
            (Date(2025, 5, 17), 0.329),
            (Date(2025, 5, 20), 0.208),
            (Date(2025, 5, 21), 0.091),
            (Date(2025, 5, 22), 0.617),
            (Date(2025, 5, 23), 0.108),
            (Date(2025, 5, 24), 0.089),
            (Date(2025, 5, 28), 0.383),
            (Date(2025, 5, 29), 0.524),
            (Date(2025, 5, 30), 0.747),
            (Date(2025, 5, 31), 0.31),
            (Date(2025, 6, 3), 0.164),
            (Date(2025, 6, 4), 0.195),
            (Date(2025, 6, 5), 0.565),
            (Date(2025, 6, 6), 0.187),
            (Date(2025, 6, 7), 0.308),
            (Date(2025, 6, 10), 0.119),
            (Date(2025, 6, 11), 0.387),
            (Date(2025, 6, 12), 0.839),
            (Date(2025, 6, 13), 0.674),
            (Date(2025, 6, 14), 0.03),
            (Date(2025, 6, 17), 0.039),
            (Date(2025, 6, 18), 0.367),
            (Date(2025, 6, 19), 0.65),
            (Date(2025, 6, 24), 0.128),
            (Date(2025, 6, 25), 0.031),
            (Date(2025, 6, 26), 0.204),
            (Date(2025, 6, 27), 0.438),
            (Date(2025, 6, 28), 0.167),
            (Date(2025, 7, 1), 0.202),
            (Date(2025, 7, 2), 0.288),
            (Date(2025, 7, 3), 0.55),
            (Date(2025, 7, 4), 0.225),
            (Date(2025, 7, 8), 0.076),
            (Date(2025, 7, 9), 0.716),
            (Date(2025, 7, 11), 0.118),
            (Date(2025, 7, 12), 0.585),
            (Date(2025, 7, 16), 0.11),
            (Date(2025, 7, 17), 0.395),
            (Date(2025, 7, 18), 0.169),
            (Date(2025, 7, 19), 0.009),
            (Date(2025, 7, 22), 0.207),
            (Date(2025, 7, 24), 0.066),
            (Date(2025, 7, 25), 0.624),
            (Date(2025, 7, 26), 0.253),
            (Date(2025, 7, 29), 0.09),
            (Date(2025, 7, 30), 0.366),
            (Date(2025, 7, 31), 0.25),
            (Date(2025, 8, 1), 0.007),
            (Date(2025, 8, 2), 0.076),
            (Date(2025, 8, 5), 0.032),
            (Date(2025, 8, 6), 0.125),
            (Date(2025, 8, 7), 0.753),
            (Date(2025, 8, 8), 0.856),
            (Date(2025, 8, 9), 0.113),
            (Date(2025, 8, 12), 0.349),
            (Date(2025, 8, 13), 0.267),
            (Date(2025, 8, 14), 0.912),
            (Date(2025, 8, 15), 0.889),
            (Date(2025, 8, 16), 0.257),
            (Date(2025, 8, 19), 0.193),
            (Date(2025, 8, 20), 0.831),
            (Date(2025, 8, 21), 0.143),
            (Date(2025, 8, 22), 0.443),
            (Date(2025, 8, 23), 0.103),
            (Date(2025, 8, 26), 0.079),
            (Date(2025, 8, 27), 0.446),
            (Date(2025, 8, 28), 0.561),
            (Date(2025, 8, 29), 0.811),
            (Date(2025, 8, 30), 0.183),
            (Date(2025, 9, 3), 0.149),
            (Date(2025, 9, 4), 0.675),
            (Date(2025, 9, 5), 0.393),
            (Date(2025, 9, 6), 0.04),
            (Date(2025, 9, 9), 0.289),
            (Date(2025, 9, 10), 0.14),
            (Date(2025, 9, 11), 0.079),
            (Date(2025, 9, 12), 1.503),
            (Date(2025, 9, 13), 0.063),
            (Date(2025, 9, 16), 0.364),
            (Date(2025, 9, 17), 0.137),
            (Date(2025, 9, 18), 0.116),
            (Date(2025, 9, 19), 0.568),
            (Date(2025, 9, 20), 0.017),
            (Date(2025, 9, 23), 0.247),
            (Date(2025, 9, 24), 0.107),
            (Date(2025, 9, 25), 0.012),
            (Date(2025, 9, 26), 0.033),
            (Date(2025, 9, 27), 0.579),
            (Date(2025, 9, 30), 0.138),
            (Date(2025, 10, 1), 0.009),
            (Date(2025, 10, 2), 0.379),
            (Date(2025, 10, 3), 0.494),
            (Date(2025, 10, 4), 0.375),
            (Date(2025, 10, 7), 0.013),
            (Date(2025, 10, 8), 0.118),
            (Date(2025, 10, 9), 0.697),
            (Date(2025, 10, 14), 0.6),
            (Date(2025, 10, 15), 0.538),
            (Date(2025, 10, 16), 0.08),
            (Date(2025, 10, 17), 0.052),
            (Date(2025, 10, 21), 0.304),
            (Date(2025, 10, 22), 0.014),
            (Date(2025, 10, 23), 0.046),
            (Date(2025, 10, 25), 0.114),
            (Date(2025, 10, 28), 0.207),
            (Date(2025, 10, 30), 0.487),
            (Date(2025, 10, 31), 0.376),
            (Date(2025, 11, 1), 0.019),
            (Date(2025, 11, 4), 0.106),
            (Date(2025, 11, 5), 0.115),
            (Date(2025, 11, 6), 0.875),
            (Date(2025, 11, 7), 1.019),
            (Date(2025, 11, 8), 0.324),
            (Date(2025, 11, 12), 0.273),
            (Date(2025, 11, 13), 0.56),
            (Date(2025, 11, 14), 1.277),
            (Date(2025, 11, 15), 0.143),
            (Date(2025, 11, 18), 0.5),
            (Date(2025, 11, 19), 0.9),
            (Date(2025, 11, 20), 0.794),
            (Date(2025, 11, 21), 0.057),
            (Date(2025, 11, 22), 0.091),
            (Date(2025, 11, 25), 0.182),
            (Date(2025, 11, 26), 0.809),
            (Date(2025, 11, 27), 0.701),
            (Date(2025, 11, 29), 0.281),
            (Date(2025, 12, 2), 0.174),
            (Date(2025, 12, 3), 0.161),
            (Date(2025, 12, 4), 0.66),
            (Date(2025, 12, 5), 0.46),
            (Date(2025, 12, 6), 0.093),
            (Date(2025, 12, 9), 0.339),
            (Date(2025, 12, 10), 0.014),
            (Date(2025, 12, 11), 0.524),
            (Date(2025, 12, 12), 0.875),
            (Date(2025, 12, 13), 0.139),
            (Date(2025, 12, 16), 0.059),
            (Date(2025, 12, 17), 0.192),
            (Date(2025, 12, 18), 0.261),
            (Date(2025, 12, 19), 0.581),
            (Date(2025, 12, 20), 0.223),
            (Date(2025, 12, 23), 0.089),
            (Date(2025, 12, 24), 0.161),
            (Date(2025, 12, 25), 0.231),
            (Date(2025, 12, 27), 0.356),
            (Date(2025, 12, 30), 0.491),
            (Date(2025, 12, 31), 0.353),
            (Date(2026, 1, 1), 0.459),
            (Date(2026, 1, 3), 0.421),
            (Date(2026, 1, 6), 0.133),
            (Date(2026, 1, 8), 0.513),
            (Date(2026, 1, 9), 0.342),
            (Date(2026, 1, 10), 0.091),
            (Date(2026, 1, 13), 0.804),
            (Date(2026, 1, 14), 0.252),
            (Date(2026, 1, 15), 0.136),
            (Date(2026, 1, 16), 0.181),
            (Date(2026, 1, 17), 0.285),
            (Date(2026, 1, 21), 0.009),
            (Date(2026, 1, 22), 0.037),
            (Date(2026, 1, 23), 0.043),
            (Date(2026, 1, 24), 0.303),
            (Date(2026, 1, 27), 0.115),
            (Date(2026, 1, 29), 0.464),
            (Date(2026, 1, 30), 0.298),
            (Date(2026, 1, 31), 0.028),
            (Date(2026, 2, 3), 0.114),
            (Date(2026, 2, 5), 0.499),
            (Date(2026, 2, 6), 0.793),
            (Date(2026, 2, 7), 0.43),
            (Date(2026, 2, 10), 0.062),
            (Date(2026, 2, 11), 0.031),
            (Date(2026, 2, 12), 0.884),
            (Date(2026, 2, 13), 1.138),
            (Date(2026, 2, 14), 0.267),
            (Date(2026, 2, 18), 1.343),
            (Date(2026, 2, 19), 0.091),
            (Date(2026, 2, 20), 0.777),
            (Date(2026, 2, 21), 0.156),
            (Date(2026, 2, 24), 0.322),
            (Date(2026, 2, 25), 0.015),
            (Date(2026, 2, 26), 0.537),
            (Date(2026, 2, 27), 0.734),
            (Date(2026, 2, 28), 0.26),
            (Date(2026, 3, 3), 0.089),
            (Date(2026, 3, 4), 0.834),
            (Date(2026, 3, 5), 0.559),
            (Date(2026, 3, 6), 0.229),
            (Date(2026, 3, 7), 0.465),
            (Date(2026, 3, 10), 0.184),
            (Date(2026, 3, 11), 0.136),
            (Date(2026, 3, 12), 0.947),
            (Date(2026, 3, 13), 0.732),
            (Date(2026, 3, 14), 0.246),
            (Date(2026, 3, 17), 0.097),
            (Date(2026, 3, 19), 0.319),
            (Date(2026, 3, 20), 0.469),
            (Date(2026, 3, 21), 0.223),
            (Date(2026, 3, 25), 0.104),
            (Date(2026, 3, 26), 0.199),
            (Date(2026, 3, 27), 0.083),
            (Date(2026, 3, 28), 0.579),
            (Date(2026, 3, 31), 0.283),
            (Date(2026, 4, 1), 0.215),
            (Date(2026, 4, 2), 0.438),
            (Date(2026, 4, 3), 0.34),
            (Date(2026, 4, 8), 0.026),
            (Date(2026, 4, 9), 0.812),
            (Date(2026, 4, 10), 0.102),
            (Date(2026, 4, 11), 0.202),
            (Date(2026, 4, 14), 0.52),
            (Date(2026, 4, 15), 0.201),
            (Date(2026, 4, 17), 0.052),
            (Date(2026, 4, 18), 0.029),
            (Date(2026, 4, 21), 0.224),
            (Date(2026, 4, 23), 0.397),
            (Date(2026, 4, 24), 0.114),
            (Date(2026, 4, 25), 0.043),
            (Date(2026, 4, 28), 0.178),
            (Date(2026, 4, 29), 0.201),
            (Date(2026, 4, 30), 0.416),
            (Date(2026, 5, 1), 0.154),
            (Date(2026, 5, 2), 0.015),
            (Date(2026, 5, 5), 0.05),
            (Date(2026, 5, 6), 0.183),
            (Date(2026, 5, 7), 0.942),
            (Date(2026, 5, 8), 0.794),
            (Date(2026, 5, 9), 0.561),
            (Date(2026, 5, 12), 0.013),
            (Date(2026, 5, 13), 0.576),
            (Date(2026, 5, 14), 1.141),
            (Date(2026, 5, 15), 0.469),
            (Date(2026, 5, 16), 0.641),
            (Date(2026, 5, 19), 0.188),
            (Date(2026, 5, 20), 0.909),
            (Date(2026, 5, 21), 0.374),
            (Date(2026, 5, 22), 0.619),
            (Date(2026, 5, 23), 0.111),
            (Date(2026, 5, 27), 0.346),
            (Date(2026, 5, 28), 0.488),
            (Date(2026, 5, 29), 0.815),
            (Date(2026, 5, 30), 0.32),
            (Date(2026, 6, 2), 0.225),
            (Date(2026, 6, 3), 0.221),
            (Date(2026, 6, 4), 0.644),
            (Date(2026, 6, 5), 0.101),
            (Date(2026, 6, 6), 0.242),
            (Date(2026, 6, 9), 0.393),
            (Date(2026, 6, 10), 0.27),
            (Date(2026, 6, 11), 0.453),
            (Date(2026, 6, 12), 0.961),
            (Date(2026, 6, 13), 0.287),
            (Date(2026, 6, 16), 0.045),
            (Date(2026, 6, 17), 0.306),
            (Date(2026, 6, 18), 0.363),
            (Date(2026, 6, 19), 0.429),
            (Date(2026, 6, 23), 0.003),
            (Date(2026, 6, 24), 0.181),
            (Date(2026, 6, 25), 0.173),
            (Date(2026, 6, 27), 0.53),
            (Date(2026, 6, 30), 0.143),
            (Date(2026, 7, 1), 0.457),
            (Date(2026, 7, 2), 0.704),
            (Date(2026, 7, 3), 0.115),
            (Date(2026, 7, 7), 0.081),
            (Date(2026, 7, 8), 0.033),
            (Date(2026, 7, 9), 0.752),
            (Date(2026, 7, 10), 0.356),
            (Date(2026, 7, 11), 0.097),
            (Date(2026, 7, 14), 0.52),
            (Date(2026, 7, 15), 0.123),
            (Date(2026, 7, 16), 0.083),
            (Date(2026, 7, 17), 0.239),
            (Date(2026, 7, 18), 0.029),
            (Date(2026, 7, 21), 0.111),
            (Date(2026, 7, 22), 0.121),
            (Date(2026, 7, 23), 0.071),
            (Date(2026, 7, 24), 0.193),
            (Date(2026, 7, 25), 0.407),
            (Date(2026, 7, 28), 0.07),
            (Date(2026, 7, 29), 0.19),
            (Date(2026, 7, 30), 0.382),
            (Date(2026, 7, 31), 0.396),
            (Date(2026, 8, 1), 0.035),
            (Date(2026, 8, 4), 0.036),
            (Date(2026, 8, 5), 0.046),
            (Date(2026, 8, 6), 0.527),
            (Date(2026, 8, 7), 1.131),
            (Date(2026, 8, 8), 0.221),
            (Date(2026, 8, 11), 0.217),
            (Date(2026, 8, 12), 0.325),
            (Date(2026, 8, 13), 0.535),
            (Date(2026, 8, 14), 0.908),
            (Date(2026, 8, 15), 0.327),
            (Date(2026, 8, 18), 0.643),
            (Date(2026, 8, 19), 0.888),
            (Date(2026, 8, 20), 0.205),
            (Date(2026, 8, 21), 0.584),
            (Date(2026, 8, 22), 0.145),
            (Date(2026, 8, 25), 0.09),
            (Date(2026, 8, 26), 0.369),
            (Date(2026, 8, 27), 0.31),
            (Date(2026, 8, 28), 0.374),
            (Date(2026, 8, 29), 0.727),
            (Date(2026, 9, 1), 0.326),
            (Date(2026, 9, 2), 0.212),
            (Date(2026, 9, 3), 0.676),
            (Date(2026, 9, 4), 0.498),
            (Date(2026, 9, 5), 0.098),
            (Date(2026, 9, 9), 0.259),
            (Date(2026, 9, 10), 0.174),
            (Date(2026, 9, 11), 0.701),
            (Date(2026, 9, 12), 0.923),
            (Date(2026, 9, 15), 0.357),
            (Date(2026, 9, 16), 0.034),
            (Date(2026, 9, 17), 0.225),
            (Date(2026, 9, 18), 0.678),
            (Date(2026, 9, 19), 0.017),
            (Date(2026, 9, 22), 0.035),
            (Date(2026, 9, 23), 0.301),
            (Date(2026, 9, 24), 0.012),
            (Date(2026, 9, 25), 0.031),
            (Date(2026, 9, 26), 0.037),
            (Date(2026, 9, 29), 0.628),
            (Date(2026, 9, 30), 0.146),
            (Date(2026, 10, 1), 0.399),
            (Date(2026, 10, 2), 0.637),
            (Date(2026, 10, 3), 0.264),
            (Date(2026, 10, 6), 0.021),
            (Date(2026, 10, 7), 0.032),
            (Date(2026, 10, 8), 0.821),
            (Date(2026, 10, 9), 0.383),
            (Date(2026, 10, 13), 0.039),
            (Date(2026, 10, 14), 0.654),
            (Date(2026, 10, 15), 0.184),
            (Date(2026, 10, 16), 0.052),
            (Date(2026, 10, 17), 0.001),
            (Date(2026, 10, 20), 0.1),
            (Date(2026, 10, 21), 0.145),
            (Date(2026, 10, 22), 0.05),
            (Date(2026, 10, 23), 0.096),
            (Date(2026, 10, 24), 0.105),
            (Date(2026, 10, 27), 0.186),
            (Date(2026, 10, 28), 0.025),
            (Date(2026, 10, 29), 0.533),
            (Date(2026, 10, 30), 0.378),
            (Date(2026, 10, 31), 0.027),
            (Date(2026, 11, 3), 0.087),
            (Date(2026, 11, 4), 0.068),
            (Date(2026, 11, 5), 0.711),
            (Date(2026, 11, 6), 0.934),
            (Date(2026, 11, 7), 0.635),
            (Date(2026, 11, 10), 0.297),
            (Date(2026, 11, 12), 0.569),
            (Date(2026, 11, 13), 1.036),
            (Date(2026, 11, 14), 0.31),
            (Date(2026, 11, 17), 0.146),
            (Date(2026, 11, 18), 1.413),
            (Date(2026, 11, 19), 0.45),
            (Date(2026, 11, 20), 0.7),
            (Date(2026, 11, 21), 0.06),
            (Date(2026, 11, 24), 0.207),
            (Date(2026, 11, 25), 0.548),
            (Date(2026, 11, 26), 0.487),
            (Date(2026, 11, 28), 0.74),
            (Date(2026, 12, 1), 0.264),
            (Date(2026, 12, 2), 0.254),
            (Date(2026, 12, 3), 0.577),
            (Date(2026, 12, 4), 0.532),
            (Date(2026, 12, 5), 0.207),
            (Date(2026, 12, 8), 0.144),
            (Date(2026, 12, 9), 0.234),
            (Date(2026, 12, 10), 0.419),
            (Date(2026, 12, 11), 0.184),
            (Date(2026, 12, 12), 0.879),
            (Date(2026, 12, 15), 0.112),
            (Date(2026, 12, 16), 0.187),
            (Date(2026, 12, 17), 0.194),
            (Date(2026, 12, 18), 0.637),
            (Date(2026, 12, 19), 0.195),
            (Date(2026, 12, 23), 0.145),
            (Date(2026, 12, 24), 0.128),
            (Date(2026, 12, 25), 0.511),
            (Date(2026, 12, 29), 0.295),
            (Date(2026, 12, 30), 0.505),
            (Date(2026, 12, 31), 0.402),
            (Date(2027, 1, 1), 0.626),
            (Date(2027, 1, 5), 0.4),
            (Date(2027, 1, 7), 0.537),
            (Date(2027, 1, 8), 0.364),
            (Date(2027, 1, 9), 0.091),
            (Date(2027, 1, 13), 0.654),
            (Date(2027, 1, 14), 0.585),
            (Date(2027, 1, 15), 0.083),
        ]

        self.fixingsData = [
            Fixing(Date(2023, 5, 24), 4115.24),
            Fixing(Date(2023, 5, 25), 4151.28),
            Fixing(Date(2023, 5, 26), 4205.45),
            Fixing(Date(2023, 5, 30), 4205.52),
            Fixing(Date(2023, 5, 31), 4179.83),
            Fixing(Date(2023, 6, 1), 4221.02),
            Fixing(Date(2023, 6, 2), 4282.37),
            Fixing(Date(2023, 6, 5), 4273.79),
            Fixing(Date(2023, 6, 6), 4283.85),
            Fixing(Date(2023, 6, 7), 4267.52),
            Fixing(Date(2023, 6, 8), 4293.93),
            Fixing(Date(2023, 6, 9), 4298.86),
            Fixing(Date(2023, 6, 12), 4338.93),
            Fixing(Date(2023, 6, 13), 4369.01),
            Fixing(Date(2023, 6, 14), 4372.59),
            Fixing(Date(2023, 6, 15), 4425.84),
            Fixing(Date(2023, 6, 16), 4409.59),
            Fixing(Date(2023, 6, 20), 4388.71),
            Fixing(Date(2023, 6, 21), 4365.69),
            Fixing(Date(2023, 6, 22), 4381.89),
            Fixing(Date(2023, 6, 23), 4348.33),
            Fixing(Date(2023, 6, 26), 4328.82),
            Fixing(Date(2023, 6, 27), 4378.41),
            Fixing(Date(2023, 6, 28), 4376.86),
            Fixing(Date(2023, 6, 29), 4396.44),
            Fixing(Date(2023, 6, 30), 4450.38),
            Fixing(Date(2023, 7, 3), 4455.59),
            Fixing(Date(2023, 7, 5), 4446.82),
            Fixing(Date(2023, 7, 6), 4411.59),
            Fixing(Date(2023, 7, 7), 4398.95),
            Fixing(Date(2023, 7, 10), 4409.53),
            Fixing(Date(2023, 7, 11), 4439.26),
            Fixing(Date(2023, 7, 12), 4472.16),
            Fixing(Date(2023, 7, 13), 4510.04),
            Fixing(Date(2023, 7, 14), 4505.42),
            Fixing(Date(2023, 7, 17), 4522.79),
            Fixing(Date(2023, 7, 18), 4554.98),
            Fixing(Date(2023, 7, 19), 4565.72),
            Fixing(Date(2023, 7, 20), 4534.87),
            Fixing(Date(2023, 7, 21), 4536.34),
            Fixing(Date(2023, 7, 24), 4554.64),
            Fixing(Date(2023, 7, 25), 4567.46),
            Fixing(Date(2023, 7, 26), 4566.75),
            Fixing(Date(2023, 7, 27), 4537.41),
            Fixing(Date(2023, 7, 28), 4582.23),
            Fixing(Date(2023, 7, 31), 4588.96),
            Fixing(Date(2023, 8, 1), 4576.73),
            Fixing(Date(2023, 8, 2), 4513.39),
            Fixing(Date(2023, 8, 3), 4501.89),
            Fixing(Date(2023, 8, 4), 4478.03),
            Fixing(Date(2023, 8, 7), 4518.44),
            Fixing(Date(2023, 8, 8), 4499.38),
            Fixing(Date(2023, 8, 9), 4467.71),
            Fixing(Date(2023, 8, 10), 4468.83),
            Fixing(Date(2023, 8, 11), 4464.05),
            Fixing(Date(2023, 8, 14), 4489.72),
            Fixing(Date(2023, 8, 15), 4437.86),
            Fixing(Date(2023, 8, 16), 4404.33),
            Fixing(Date(2023, 8, 17), 4370.36),
            Fixing(Date(2023, 8, 18), 4369.71),
            Fixing(Date(2023, 8, 21), 4399.77),
            Fixing(Date(2023, 8, 22), 4387.55),
            Fixing(Date(2023, 8, 23), 4436.01),
            Fixing(Date(2023, 8, 24), 4376.31),
            Fixing(Date(2023, 8, 25), 4405.71),
            Fixing(Date(2023, 8, 28), 4433.31),
            Fixing(Date(2023, 8, 29), 4497.63),
            Fixing(Date(2023, 8, 30), 4514.87),
            Fixing(Date(2023, 8, 31), 4507.66),
            Fixing(Date(2023, 9, 1), 4515.77),
            Fixing(Date(2023, 9, 5), 4496.83),
            Fixing(Date(2023, 9, 6), 4465.48),
            Fixing(Date(2023, 9, 7), 4451.14),
            Fixing(Date(2023, 9, 8), 4457.49),
            Fixing(Date(2023, 9, 11), 4487.46),
            Fixing(Date(2023, 9, 12), 4461.9),
            Fixing(Date(2023, 9, 13), 4467.44),
            Fixing(Date(2023, 9, 14), 4505.1),
            Fixing(Date(2023, 9, 15), 4450.32),
            Fixing(Date(2023, 9, 18), 4453.53),
            Fixing(Date(2023, 9, 19), 4443.95),
            Fixing(Date(2023, 9, 20), 4402.2),
            Fixing(Date(2023, 9, 21), 4330),
            Fixing(Date(2023, 9, 22), 4320.06),
            Fixing(Date(2023, 9, 25), 4337.44),
            Fixing(Date(2023, 9, 26), 4273.53),
            Fixing(Date(2023, 9, 27), 4274.51),
            Fixing(Date(2023, 9, 28), 4299.7),
            Fixing(Date(2023, 9, 29), 4288.05),
            Fixing(Date(2023, 10, 2), 4288.39),
            Fixing(Date(2023, 10, 3), 4229.45),
            Fixing(Date(2023, 10, 4), 4263.75),
            Fixing(Date(2023, 10, 5), 4258.19),
            Fixing(Date(2023, 10, 6), 4308.5),
            Fixing(Date(2023, 10, 9), 4335.66),
            Fixing(Date(2023, 10, 10), 4358.24),
            Fixing(Date(2023, 10, 11), 4376.95),
            Fixing(Date(2023, 10, 12), 4349.61),
            Fixing(Date(2023, 10, 13), 4327.78),
            Fixing(Date(2023, 10, 16), 4373.63),
            Fixing(Date(2023, 10, 17), 4373.2),
            Fixing(Date(2023, 10, 18), 4314.6),
            Fixing(Date(2023, 10, 19), 4278),
            Fixing(Date(2023, 10, 20), 4224.16),
            Fixing(Date(2023, 10, 23), 4217.04),
            Fixing(Date(2023, 10, 24), 4247.68),
            Fixing(Date(2023, 10, 25), 4186.77),
            Fixing(Date(2023, 10, 26), 4137.23),
            Fixing(Date(2023, 10, 27), 4117.37),
            Fixing(Date(2023, 10, 30), 4166.82),
            Fixing(Date(2023, 10, 31), 4193.8),
            Fixing(Date(2023, 11, 1), 4237.86),
            Fixing(Date(2023, 11, 2), 4317.78),
            Fixing(Date(2023, 11, 3), 4358.34),
            Fixing(Date(2023, 11, 6), 4365.98),
            Fixing(Date(2023, 11, 7), 4378.38),
            Fixing(Date(2023, 11, 8), 4382.78),
            Fixing(Date(2023, 11, 9), 4347.35),
            Fixing(Date(2023, 11, 10), 4415.24),
            Fixing(Date(2023, 11, 13), 4411.55),
            Fixing(Date(2023, 11, 14), 4495.7),
            Fixing(Date(2023, 11, 15), 4502.88),
            Fixing(Date(2023, 11, 16), 4508.24),
            Fixing(Date(2023, 11, 17), 4514.02),
            Fixing(Date(2023, 11, 20), 4547.38),
            Fixing(Date(2023, 11, 21), 4538.19),
            Fixing(Date(2023, 11, 22), 4556.62),
            Fixing(Date(2023, 11, 24), 4559.34),
            Fixing(Date(2023, 11, 27), 4550.43),
            Fixing(Date(2023, 11, 28), 4554.89),
            Fixing(Date(2023, 11, 29), 4550.58),
            Fixing(Date(2023, 11, 30), 4567.8),
            Fixing(Date(2023, 12, 1), 4594.63),
            Fixing(Date(2023, 12, 4), 4569.78),
            Fixing(Date(2023, 12, 5), 4567.18),
            Fixing(Date(2023, 12, 6), 4549.34),
            Fixing(Date(2023, 12, 7), 4585.59),
            Fixing(Date(2023, 12, 8), 4604.37),
            Fixing(Date(2023, 12, 11), 4622.44),
            Fixing(Date(2023, 12, 12), 4643.7),
            Fixing(Date(2023, 12, 13), 4707.09),
            Fixing(Date(2023, 12, 14), 4719.55),
            Fixing(Date(2023, 12, 15), 4719.19),
            Fixing(Date(2023, 12, 18), 4740.56),
            Fixing(Date(2023, 12, 19), 4768.37),
            Fixing(Date(2023, 12, 20), 4698.35),
            Fixing(Date(2023, 12, 21), 4746.75),
            Fixing(Date(2023, 12, 22), 4754.63),
            Fixing(Date(2023, 12, 26), 4774.75),
            Fixing(Date(2023, 12, 27), 4781.58),
            Fixing(Date(2023, 12, 28), 4783.35),
            Fixing(Date(2023, 12, 29), 4769.83),
            Fixing(Date(2024, 1, 2), 4742.83),
            Fixing(Date(2024, 1, 3), 4704.81),
            Fixing(Date(2024, 1, 4), 4688.68),
            Fixing(Date(2024, 1, 5), 4697.24),
            Fixing(Date(2024, 1, 8), 4763.54),
            Fixing(Date(2024, 1, 9), 4756.5),
            Fixing(Date(2024, 1, 10), 4783.45),
            Fixing(Date(2024, 1, 11), 4780.24),
            Fixing(Date(2024, 1, 12), 4783.83),
            Fixing(Date(2024, 1, 16), 4765.98),
            Fixing(Date(2024, 1, 17), 4739.21),
            Fixing(Date(2024, 1, 18), 4780.94),
        ]

    def build_var_swap(self):
        hc = Calendar(name="te", start_date=Date(2014, 1, 1), end_date=Date(2100, 1, 1), holidays=[Date(2024,1,2)])
        var_swap = VarSwap.make(
            self.instrumentID,
            [self.underlyingID],
            self.buySell,
            self.notional,
            self.strike,
            self.ccy,
            self.effTimePoint,
            self.matTimePoint,
            self.lag,
            self.cap,
            hc
        )
        return var_swap

    def build_borrow_curve(self):
        return InterestRateTermStructure.make(self.refDate, self.dcc, self.ccy, self.borrowCurveData)

    def build_yield_curve(self):
        return InterestRateTermStructure.make(self.refDate, self.dcc, self.ccy, self.yieldCurveData)

    def build_fixings(self):
        return Fixings(self.fixingsData)

    def build_eq_vol_grid(self):
        vols = VolSliceMap()
        for i in range(len(self.expiryDate)):
            slice = Slice()
            expiry = self.expiryDate[i]
            for j in range(len(self.strikes)):
                strike = Strike(self.strikes[j])
                vol = self.volbyStrikeExpiry[i][j]
                slice[strike] = vol

            vols[expiry] = slice

        grid = EqVolatilityGrid.make(self.underlyingID, self.dc, self.valuationTimePoint, vols, self.underlying,
                                     self.ccy, self.exchCode)

        return grid

    def test_eq_vol_swap_engine(self):
        vol_grid = self.build_eq_vol_grid()
        borrow_curve = self.build_borrow_curve()
        yield_curve = self.build_yield_curve()
        engine = NxEQVolatilityEngine.make(self.valuationTimePoint, self.spot, borrow_curve, yield_curve, self.dividendCurveData)
        engine.setVolatilityModel("DUPIRE")
        vol_grid.setVolatilityEngine(engine)

        fit_results = vol_grid.fit()
        fixings = self.build_fixings()
        pricing_engine = NxEqVarSwapEngine.make(self.valuationTimePoint, {self.underlyingPricingID: fit_results}, fixings)

        var_swap = self.build_var_swap()
        var_swap.setPricingEngine(pricing_engine)
        r = var_swap.calculateAllResults()
        val = r.getResult('PV')
        self.assertEqual(-235.57615857939268, val)
        # self.assertEqual(val, -7.163557298795646)


if __name__ == '__main__':
    unittest.main()
